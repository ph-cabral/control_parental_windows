<!DOCTYPE html>
<html>
<head>
	<title>Asignar Tiempo</title>
	<HTA:APPLICATION 
        	ID="GeneradorApp"
		APPLICATIONNAME="Asignar Tiempo"
		BORDER="thin"
		BORDERSTYLE="normal"
	        CAPTION="yes"
		ICON=""
		MAXIMIZEBUTTON="yes"
	        MINIMIZEBUTTON="yes"
        	SHOWINTASKBAR="yes"
	        SINGLEINSTANCE="yes"
	        SYSMENU="yes"
	        VERSION="1.0"
	        WINDOWSTATE="normal"
	/>

	<style>
        	body {
			font-family: Arial, sans-serif;
			margin: 20px;
			background-color: #f4f4f4;
			text-align: center; 
        	}
        	.container, .login-container {
			background-color: white;
			padding: 20px;
			border-radius: 15px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.1);
			width: fit-content;
			margin: 0 auto;
text-align: center;
        	}
		h2 {
			margin-top: 0;
		}
	        input[type="number"], input[type="password"] {
        		width: 100px;
			padding: 8px;
			box-sizing: border-box;
			margin-bottom: 10px;
	        }
        	hr {
			color: #4CAF50;
			
			padding: 10px 15px;
    box-sizing: border-box;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-size: 16px;
margin-bottom: 10px;
    text-align: center;
        	}
		button:hover {
			background-color: #45a049;
        	}
	        .hidden {
            display: none;
        }
    </style>

    <script language="JScript">
        function leerClave() {
            try {
                var fso = new ActiveXObject("Scripting.FileSystemObject");
                var archivo = fso.OpenTextFile("_clave.txt", 1); // Lectura de archivo
                var clave = archivo.ReadLine();
                archivo.Close();
                return clave;
            } catch (e) {
                alert("Error al leer el archivo de clave.");
                return null;
            }
        }

        function validarClave() {
            var clave = document.getElementById("clave").value;
            var claveCorrecta = leerClave();
            if (claveCorrecta && clave === claveCorrecta) {
                document.getElementById("login").style.display = "none";
                document.getElementById("app").style.display = "block";
                document.getElementById("clave").value = ""; // limpia el campo por seguridad
	       // document.getElementById('value1').focus();
	    } else {
                window.close();
            }
        }







function cargarUsuarios() {
    try {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
        if (!fso.FileExists("_usuarios.txt")) {
            alert("El archivo usuarios.txt no se encuentra.");
            return;
        }

        var archivo = fso.OpenTextFile("_usuarios.txt", 1); // 1 = lectura
        var tabla = document.getElementById("usuariosBody");
        var contador = 1;

        while (!archivo.AtEndOfStream) {
            var usuario = archivo.ReadLine().replace(/^\s+|\s+$/g, "");
            if (usuario !== "") {
                var fila = document.createElement("tr");

                var celdaNombre = document.createElement("td");
                celdaNombre.innerText = usuario;

                var celdaInput = document.createElement("td");
                var input = document.createElement("input");
                input.type = "number";
                input.id = "value" + contador;
                celdaInput.appendChild(input);

                fila.appendChild(celdaNombre);
                fila.appendChild(celdaInput);
                tabla.appendChild(fila);

                contador++;
            }
        }

        archivo.Close();
    } catch (e) {
        alert("Error al leer usuarios.txt: " + e.message);
    }
}









        function crearArchivoTxt(nombreArchivo, contenido) {
            try {
                var fso = new ActiveXObject("Scripting.FileSystemObject");
                var archivo = fso.CreateTextFile(nombreArchivo, true);
                archivo.WriteLine(contenido);
                archivo.Close();
                return true;
            } catch (e) {
                return false;
            }
        }



        function generarArchivos() {
            var tabla = document.getElementById('dataTable');
            var filas = tabla.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            var archivosCreados = 0;

            for (var i = 0; i < filas.length; i++) {
                var nombre = filas[i].cells[0].innerText;
                var input = filas[i].cells[1].getElementsByTagName('input')[0];
                var valor = parseFloat(input.value);
                if (!isNaN(valor) && valor > 0) {
                    if (crearArchivoTxt("tiempo_" + nombre + ".txt", valor)) {
                        archivosCreados++;
                    }
                }
            }

           
        }

        document.onkeypress = function(e) {
            if (!e) e = window.event;
            var key = e.keyCode || e.which;
            if (key === 13) { // Detecta si presiona "Enter"
                if (document.getElementById("app").style.display === "none") {
                    validarClave(); // Validación de clave al presionar "Enter"
                } else {
                    generarArchivos(); // Si ya está en la app, genera archivos
                    window.close();
                }
            }
        };

       window.onload = function() {
    document.getElementById('clave').focus();
    cargarUsuarios();
    var tabla = document.getElementById("dataTable");
    var filas = tabla.getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;

    var altura = 350 + (filas * 50); 
    var ancho = 400;

    window.resizeTo(ancho, altura);
};

    </script>
</head>

<body>
    <div id="login" class="login-container">
        <h2>Ingresar Clave</h2>
<hr/>
        <input type="password" id="clave" placeholder="Contraseña" autofocus/>
<hr/>
        <h3>Enter para acceder</h3>
    </div>

    <div id="app" class="container hidden" style="display:none">
        <h2>Asignar Tiempo</h2>
<hr/>
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Minutos</th>
                </tr>
            </thead>
            <tbody id="usuariosBody">
                
 
            </tbody>
        </table>

<hr/>
<span>Presione Enter</span>
     
        <div id="statusMsg"></div>
    </div>
</body>
</html>
